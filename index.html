<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>bars</title>
        <script type="text/javascript" src="d3/d3.js"></script>
        <style>

        body {
            margin: auto;
            width: 960px;
        }

        svg {
            font: 10px sans-serif;
        }

        .axis path,         /* selects all path elements inside elements with class="axis" */
        .axis line{
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        </style>
    </head>
    <body>

        <script type="text/javascript">

            //Width and height
            var w = 500;
            var h = 300;

            var m = 1396984337000;
            var k = 21600; 

            //Original data
            var dataset = [
                [
                // layer 1 ------- y0: 0                        = 0
                    { x: 0, y: m + 0*k, z:1 }, // bar 1
                    { x: 1, y: m + 0*k, z:0 }, // bar 2
                    { x: 2, y: m + 0*k, z:1 }, // bar 3
                    { x: 3, y: m + 0*k, z:1 }, // bar 4
                    { x: 4, y: m + 0*k, z:0 }, // bar 5
                    { x: 5, y: m + 0*k, z:0 }  // bar 6
                ],
                [
                // layer 2 -------- y0: m+0*k                   = m
                    { x: 0, y: m + 1*k, z:0 }, 
                    { x: 1, y: m + 1*k, z:1 }, 
                    { x: 2, y: m + 1*k, z:1 },
                    { x: 3, y: m + 1*k, z:0 },
                    { x: 4, y: m + 1*k, z:1 },
                    { x: 5, y: m + 1*k, z:0 }  
                ],
                [
                // layer 3 -------- y0: m+0*k + m+1*k           = 2m + k
                    { x: 0, y: m + 2*k, z:1 }, 
                    { x: 1, y: m + 2*k, z:0 }, 
                    { x: 2, y: m + 2*k, z:0 }, 
                    { x: 3, y: m + 2*k, z:1 },
                    { x: 4, y: m + 2*k, z:1 },
                    { x: 5, y: m + 2*k, z:0 }  
                ],
                [
                // layer 4 -------- y0: m+0*k + m+1*k + m+2*k   = 3m + 3k 
                    { x: 0, y: m + 3*k, z:1 }, 
                    { x: 1, y: m + 3*k, z:0 }, 
                    { x: 2, y: m + 3*k, z:1 }, 
                    { x: 3, y: m + 3*k, z:1 },
                    { x: 4, y: m + 3*k, z:0 },
                    { x: 5, y: m + 3*k, z:1 }
                ]
            ];

            //Set up stack method
            var stack = d3.layout.stack();

            //Data, stacked
            stack(dataset);
            console.log(dataset);

            // now we have y0

            //Set up scales
            var f = d3.time.scale()
                .domain([m + 0*k, m + 3*k])
                .range([0, w - w / dataset.length]); 

            /*var yRange = [];
            for (var i in d3.range(dataset[0].length)) {
                i*=100;
                yRange.push(i);
            }*/

            var g = d3.scale.linear()
                .domain([0, dataset[0].length]) // [0, 4]
                .range([0, h]); 
                
            //Custom colors
            var colors = d3.scale.ordinal()
                .domain([0, 1])
                .range(["rgb(224, 224, 224)","rgb(0, 204, 102)"]);
        
            //Create SVG element
            var svg = d3.select("body")
                        .append("svg")
                        .attr("width", w)
                        .attr("height", h);
    
            // each group --> a layer
            var groups = svg.selectAll("g")
                .data(dataset)
              .enter().append("g");
    
            // Add a rect for each data value
            var rects = groups.selectAll("rect")
                .data(function(d) { return d; })
              .enter().append("rect")
                .attr("x", function(d) {
                    return f(d.y);
                })
                .attr("y", function(d) {
                    return g(d.x); 
                })
                .attr("width", function(d) {
                    return w / dataset.length;  // assumes equal time intervals
                })
                .attr("height", h / dataset[0].length - 1)
                .style("fill", function(d) { return colors(d.z); });

        </script>
    </body>
</html>